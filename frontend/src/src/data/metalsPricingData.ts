// Интерфейс для данных о ценах на металлопродукцию
export interface MetalPricingRecord {
  "вид продукции": string;
  "склад": string;
  "наименование": string;
  "марка стали": string;
  "диаметр": string;
  "ГОСТ": string;
  "цена": number;
  "наличие": string;
  "производитель": string;
}

export interface MetalsPricingData {
  generated_at: string;
  currency: string;
  price_unit: string;
  records: MetalPricingRecord[];
}

// Моковые данные на основе предоставленного JSON
export const metalsPricingData: MetalsPricingData = {
  "generated_at": "2025-09-21T00:00:00Z",
  "currency": "RUB",
  "price_unit": "руб/т",
  "records": [
    {
      "вид продукции": "Трубы бесшовные горячекатаные",
      "склад": "Москва",
      "наименование": "Труба бесшовная 57×3.5 20 ГОСТ 8732-78",
      "марка стали": "20",
      "диаметр": "57×3.5 мм",
      "ГОСТ": "8732-78",
      "цена": 90500,
      "наличие": "в наличии (30 т)",
      "производитель": "ТМК"
    },
    {
      "вид продукции": "Трубы бесшовные холоднодеформированные",
      "склад": "Санкт-Петербург",
      "наименование": "Труба бесшовная 20×2 20 ГОСТ 8734-75",
      "марка стали": "20",
      "диаметр": "20×2 мм",
      "ГОСТ": "8734-75",
      "цена": 106000,
      "наличие": "мало (18 т)",
      "производитель": "ЧТПЗ"
    },
    {
      "вид продукции": "Трубы электросварные",
      "склад": "Екатеринбург",
      "наименование": "Труба ЭСВ 40×3 Ст3сп ГОСТ 10704-91",
      "марка стали": "Ст3сп",
      "диаметр": "40×3 мм",
      "ГОСТ": "10704-91",
      "цена": 69000,
      "наличие": "под заказ (до 60 т)",
      "производитель": "Северсталь"
    },
    {
      "вид продукции": "Трубы водогазопроводные",
      "склад": "Волгоград",
      "наименование": "Труба ВГП 32×3.2 Ст3сп ГОСТ 3262-75",
      "марка стали": "Ст3сп",
      "диаметр": "32×3.2 мм",
      "ГОСТ": "3262-75",
      "цена": 69000,
      "наличие": "в наличии (51 т)",
      "производитель": "ТМК"
    },
    {
      "вид продукции": "Трубы сварные профильные",
      "склад": "Казань",
      "наименование": "Труба профильная 80×40×3 Ст3сп ГОСТ 8645-68",
      "марка стали": "Ст3сп",
      "диаметр": "80×40×3 мм",
      "ГОСТ": "8645-68",
      "цена": 77000,
      "наличие": "мало (27 т)",
      "производитель": "ЧТПЗ"
    },
    {
      "вид продукции": "Трубы большого диаметра (от 530 мм)",
      "склад": "Нижний Новгород",
      "наименование": "Труба ЛС 920×12 09Г2С ГОСТ 20295-85",
      "марка стали": "09Г2С",
      "диаметр": "920×12 мм",
      "ГОСТ": "20295-85",
      "цена": 110000,
      "наличие": "под заказ (до 75 т)",
      "производитель": "ЧТПЗ"
    },
    {
      "вид продукции": "Трубы нержавеющие",
      "склад": "Челябинск",
      "наименование": "Труба нерж. 76×3 12Х18Н10Т ГОСТ 9941-81",
      "марка стали": "12Х18Н10Т",
      "диаметр": "76×3 мм",
      "ГОСТ": "9941-81",
      "цена": 229000,
      "наличие": "в наличии (72 т)",
      "производитель": "ТМК-INOX"
    },
    {
      "вид продукции": "Трубы оцинкованные",
      "склад": "Новосибирск",
      "наименование": "Труба ВГП оцинк. 20×2.8 Ст3сп ГОСТ 3262-75 (оцинк.)",
      "марка стали": "Ст3сп",
      "диаметр": "20×2.8 мм",
      "ГОСТ": "3262-75 (оцинк.)",
      "цена": 77600,
      "наличие": "мало (36 т)",
      "производитель": "Северсталь"
    },
    {
      "вид продукции": "Трубы бесшовные горячекатаные",
      "склад": "Самара",
      "наименование": "Труба бесшовная 168×8 09Г2С ГОСТ 8732-78",
      "марка стали": "09Г2С",
      "диаметр": "168×8 мм",
      "ГОСТ": "8732-78",
      "цена": 92000,
      "наличие": "под заказ (до 90 т)",
      "производитель": "ОМК"
    },
    {
      "вид продукции": "Трубы бесшовные холоднодеформированные",
      "склад": "Ростов-на-Дону",
      "наименование": "Труба бесшовная 14×2 10 ГОСТ 8734-75",
      "марка стали": "10",
      "диаметр": "14×2 мм",
      "ГОСТ": "8734-75",
      "цена": 108000,
      "наличие": "в наличии (93 т)",
      "производитель": "ТМК"
    },
    {
      "вид продукции": "Трубы электросварные",
      "склад": "Москва",
      "наименование": "Труба ЭСВ 25×2.5 Ст3сп ГОСТ 10704-91",
      "марка стали": "Ст3сп",
      "диаметр": "25×2.5 мм",
      "ГОСТ": "10704-91",
      "цена": 70000,
      "наличие": "мало (45 т)",
      "производитель": "ОМК"
    },
    {
      "вид продукции": "Трубы водогазопроводные",
      "склад": "Санкт-Петербург",
      "наименование": "Труба ВГП 50×3.5 Ст3сп ГОСТ 3262-75",
      "марка стали": "Ст3сп",
      "диаметр": "50×3.5 мм",
      "ГОСТ": "3262-75",
      "цена": 69800,
      "наличие": "под заказ (до 105 т)",
      "производитель": "ЧТПЗ"
    },
    {
      "вид продукции": "Трубы сварные профильные",
      "склад": "Екатеринбург",
      "наименование": "Труба профильная 80×40×3 Ст3сп ГОСТ 8645-68",
      "марка стали": "Ст3сп",
      "диаметр": "80×40×3 мм",
      "ГОСТ": "8645-68",
      "цена": 78000,
      "наличие": "в наличии (114 т)",
      "производитель": "ТМК"
    },
    {
      "вид продукции": "Трубы большого диаметра (от 530 мм)",
      "склад": "Волгоград",
      "наименование": "Труба ЛС 1020×12 09Г2С ГОСТ 20295-85",
      "марка стали": "09Г2С",
      "диаметр": "1020×12 мм",
      "ГОСТ": "20295-85",
      "цена": 112500,
      "наличие": "мало (54 т)",
      "производитель": "ОМК"
    },
    {
      "вид продукции": "Трубы нержавеющие",
      "склад": "Казань",
      "наименование": "Труба нерж. 42×2 10Х17Н13М2Т ГОСТ 9941-81",
      "марка стали": "10Х17Н13М2Т",
      "диаметр": "42×2 мм",
      "ГОСТ": "9941-81",
      "цена": 211000,
      "наличие": "под заказ (до 120 т)",
      "производитель": "Импорт"
    },
    {
      "вид продукции": "Трубы оцинкованные",
      "склад": "Нижний Новгород",
      "наименование": "Труба ВГП оцинк. 32×3.2 Ст3сп ГОСТ 3262-75 (оцинк.)",
      "марка стали": "Ст3сп",
      "диаметр": "32×3.2 мм",
      "ГОСТ": "3262-75 (оцинк.)",
      "цена": 78400,
      "наличие": "в наличии (135 т)",
      "производитель": "ТМК"
    },
    {
      "вид продукции": "Трубы бесшовные горячекатаные",
      "склад": "Челябинск",
      "наименование": "Труба бесшовная 133×6 35 ГОСТ 8732-78",
      "марка стали": "35",
      "диаметр": "133×6 мм",
      "ГОСТ": "8732-78",
      "цена": 93500,
      "наличие": "мало (63 т)",
      "производитель": "ЧТПЗ"
    },
    {
      "вид продукции": "Трубы бесшовные холоднодеформированные",
      "склад": "Новосибирск",
      "наименование": "Труба бесшовная 76×4 35 ГОСТ 8734-75",
      "марка стали": "35",
      "диаметр": "76×4 мм",
      "ГОСТ": "8734-75",
      "цена": 110000,
      "наличие": "под заказ (до 135 т)",
      "производитель": "ОМК"
    },
    {
      "вид продукции": "Трубы электросварные",
      "склад": "Самара",
      "наименование": "Труба ЭСВ 219×6 Ст3сп ГОСТ 10704-91",
      "марка стали": "Ст3сп",
      "диаметр": "219×6 мм",
      "ГОСТ": "10704-91",
      "цена": 71000,
      "наличие": "в наличии (156 т)",
      "производитель": "ТМК"
    }
  ]
};

// Функции для работы с данными
export const getUniqueValues = (records: MetalPricingRecord[], field: keyof MetalPricingRecord): string[] => {
  const values = new Set(records.map(record => String(record[field])));
  return Array.from(values).sort();
};

export const getFilteredRecords = (
  records: MetalPricingRecord[],
  filters: {
    productType: string;
    warehouse: string;
    name: string;
    steelGrade: string;
    diameter: string;
    gost: string;
  }
): MetalPricingRecord[] => {
  return records.filter(record => {
    if (filters.productType !== 'Все виды' && record['вид продукции'] !== filters.productType) return false;
    if (filters.warehouse !== 'Все склады' && record['склад'] !== filters.warehouse) return false;
    if (filters.name && !record['наименование'].toLowerCase().includes(filters.name.toLowerCase())) return false;
    if (filters.steelGrade !== 'Все марки' && record['марка стали'] !== filters.steelGrade) return false;
    if (filters.diameter !== 'Все диаметры' && record['диаметр'] !== filters.diameter) return false;
    if (filters.gost !== 'Все ГОСТы' && record['ГОСТ'] !== filters.gost) return false;
    return true;
  });
};

export const getAveragePrice = (records: MetalPricingRecord[]): number => {
  if (records.length === 0) return 0;
  const total = records.reduce((sum, record) => sum + record['цена'], 0);
  return Math.round(total / records.length);
};

export const getPriceRange = (records: MetalPricingRecord[]): { min: number; max: number } => {
  if (records.length === 0) return { min: 0, max: 0 };
  const prices = records.map(record => record['цена']);
  return {
    min: Math.min(...prices),
    max: Math.max(...prices)
  };
};